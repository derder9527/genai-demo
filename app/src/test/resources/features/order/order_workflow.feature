# language: zh-TW
功能: 訂單工作流程
  作為一個訂單系統
  我需要管理訂單的完整生命週期
  從創建到完成或取消

  背景:
    假設系統中有可用的商品
    並且客戶已經登入系統

  場景: 完整訂單流程 - 從創建到完成
    # 創建訂單
    當客戶瀏覽商品目錄
    並且客戶選擇商品 "iPhone 15"
    並且客戶將商品添加到訂單中
    並且客戶提交訂單
    
    # 訂單驗證
    那麼系統應該驗證訂單
    並且訂單應該有效
    
    # 庫存檢查
    當系統檢查庫存
    並且庫存充足
    
    # 支付處理
    並且客戶選擇信用卡支付方式
    並且客戶輸入有效的信用卡信息
    並且支付系統處理支付
    並且支付成功
    
    # 訂單確認
    那麼系統應該確認訂單
    並且訂單狀態應該更新為 "已確認"
    並且客戶應該收到訂單確認通知
    
    # 配送處理
    當系統安排配送
    並且物流系統建立配送單
    並且物流系統分配配送資源
    並且物流系統執行配送
    
    # 訂單完成
    並且客戶收到訂單
    並且客戶確認收貨
    那麼訂單狀態應該更新為 "已完成"
    並且客戶應該能夠評價訂單

  場景: 訂單流程 - 庫存不足導致取消
    # 創建訂單
    當客戶創建一個包含商品 "限量版手機" 的訂單
    並且客戶提交訂單
    
    # 訂單驗證
    那麼系統應該驗證訂單
    並且訂單應該有效
    
    # 庫存檢查
    當系統檢查庫存
    並且庫存不足
    
    # 訂單取消
    那麼系統應該取消訂單
    並且訂單狀態應該更新為 "已取消"
    並且取消原因應該為 "庫存不足"
    並且客戶應該收到庫存不足通知

  場景: 訂單流程 - 支付失敗導致取消
    # 創建訂單
    當客戶創建一個包含有效商品的訂單
    並且客戶提交訂單
    
    # 訂單驗證和庫存檢查
    那麼系統應該驗證訂單
    並且訂單應該有效
    當系統檢查庫存
    並且庫存充足
    
    # 支付處理
    並且客戶選擇信用卡支付方式
    並且客戶輸入無效的信用卡信息
    並且支付系統處理支付
    並且支付失敗
    
    # 訂單取消
    那麼系統應該取消訂單
    並且訂單狀態應該更新為 "已取消"
    並且取消原因應該為 "支付失敗"
    並且客戶應該收到支付失敗通知

  場景: 訂單流程 - 客戶主動取消
    # 創建訂單
    當客戶創建一個包含有效商品的訂單
    並且訂單狀態為 "待支付"
    
    # 客戶取消
    並且客戶請求取消訂單
    並且客戶提供取消原因 "找到更好的選擇"
    
    # 訂單取消
    那麼系統應該取消訂單
    並且訂單狀態應該更新為 "已取消"
    並且取消原因應該為 "客戶請求"
    並且系統應該釋放預留的庫存
    並且客戶應該收到訂單取消確認通知