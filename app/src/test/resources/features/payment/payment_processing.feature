# language: zh-TW
功能: 支付處理
  作為一個客戶
  我希望能夠為我的訂單進行支付
  以便完成購買流程

  背景:
    假設我已經創建了一個訂單
    並且訂單包含有效的商品
    並且訂單已提交

  場景: 成功處理信用卡支付
    當系統確認庫存充足
    並且我選擇信用卡支付方式
    並且我輸入有效的信用卡信息
      | 卡號             | 有效期   | 安全碼 |
      | 4111111111111111 | 12/2025 | 123    |
    並且我確認支付
    那麼支付系統應該驗證支付信息
    並且支付系統應該執行支付交易
    並且支付狀態應該更新為 "已完成"
    並且訂單狀態應該更新為 "已確認"
    並且我應該收到支付成功的通知

  場景: 信用卡支付失敗 - 餘額不足
    當系統確認庫存充足
    並且我選擇信用卡支付方式
    並且我輸入餘額不足的信用卡信息
    並且我確認支付
    那麼支付系統應該驗證支付信息
    並且支付系統應該拒絕支付交易
    並且支付狀態應該更新為 "失敗"
    並且訂單狀態應該更新為 "失敗"
    並且我應該收到支付失敗的通知
    並且通知應該包含錯誤信息 "信用卡餘額不足"

  場景: 信用卡支付失敗 - 無效卡號
    當系統確認庫存充足
    並且我選擇信用卡支付方式
    並且我輸入無效的信用卡號
    並且我確認支付
    那麼支付系統應該驗證支付信息
    並且支付系統應該拒絕支付交易
    並且支付狀態應該更新為 "失敗"
    並且訂單狀態應該更新為 "失敗"
    並且我應該收到支付失敗的通知
    並且通知應該包含錯誤信息 "無效的信用卡號"

  場景: 支付超時
    當系統確認庫存充足
    並且我選擇信用卡支付方式
    並且支付網關響應超時
    那麼系統應該在等待30秒後取消支付請求
    並且支付狀態應該更新為 "失敗"
    並且訂單狀態應該更新為 "待支付"
    並且我應該收到支付超時的通知
    並且我應該能夠重新嘗試支付

  場景: 成功處理銀行轉賬支付
    當系統確認庫存充足
    並且我選擇銀行轉賬支付方式
    並且我完成銀行轉賬
    並且銀行確認轉賬成功
    那麼支付系統應該驗證轉賬信息
    並且支付狀態應該更新為 "已完成"
    並且訂單狀態應該更新為 "已確認"
    並且我應該收到支付成功的通知

  場景: 支付成功後申請退款
    假設我已經成功支付了訂單
    當我申請退款
    並且我提供有效的退款理由
    那麼系統應該創建退款請求
    並且支付系統應該處理退款
    並且退款狀態應該更新為 "處理中"
    並且我應該收到退款申請已受理的通知